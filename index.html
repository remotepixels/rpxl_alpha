<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="-1"/>
    <meta name="msapplication-TileColor" content="#2e2e2e"/>
    <meta name="description" content="Serverless web app that allows you transmit to a high quality stream to clients to view and comment on using WEBRTC and VDO.NINJA. Communication between clients is handled using low latency and very little bandwidth, dedicating as much bandwidth to the main strea, often the feed from an edit machine. Also, we think Capybara's are awesome though that might not be relevant in this case.">
    <meta name="keywords" content="Gui Felix, Advertising, Visual Effects, Motion Graphics, Remote Pixels, vdo.ninja"/>
    <meta name="robots" content="index, follow"/>
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="icons/favicon.ico">
    <meta name="color-scheme" content="light dark">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@200" rel="stylesheet">

    <link rel="stylesheet" href="styles/clientstyle.css">
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/mobilestyle.css">

    <title>alpha.rpxl.app v3</title>
</head>

<body id="body">
        
    <div id="shmeg" class="shmeg">
        <div class="siteHeader">
            <div class="text">
                <!-- <img src="icons/android-chrome-192x192.png" class="siteMainIcon"/> -->
                <div class="siteTitle">RPXL</div>
                <p></p>
                <div class="siteSubTitle">Simple,<br>secure,<br>server less,<br>remote collaboration.</div>
            </div>
        </div>

        <div class="textBackground">
            <div class="text">
                <p>&nbsp;</p>
                <h4>Stream high quality video from anywhere, to anywhere using only your browser.<sup>*</sup></h4>
                <p>Using the incredible open source <a href="https://vdo.ninja">vdo.ninja</a> software created by <a href="https://github.com/steveseguin/vdo.ninja">Steve Seguin</a>, RPXL is an optimised and simplified front end focused for realtime, remote, editorial approvals.</p>
                <p>Created as an alternative to server based messaging apps, vdo.ninja uses a peer to peer model allowing very low latency using webRTC and modern video codecs.</p>
                <p>Bandwidth is concentrated on one, high quality primary video stream. With only minimal data used for communication between participants (typically between 30kbps to 90kbps per participant).</p>
                <p><img src="images/interface.jpg" width="750" height="453" style="border-radius: 10px; overflow: hidden; position: relative; display: inline-block;"></p>
                <p>RPXL puts your work front and centre.</p>
                <p>&nbsp;</p>

                <h4>No sign-ups, no downloads, <br>no watermarks, no time limits.<sup>**</sup></h4>
                <p><img src="images/join.jpg" width="300" height="520" style="border-radius: 10px; overflow: hidden; margin-right:50px; float:left">
                <p> As this app is essentially server-less there are no costs in running this service. </p>
                <p>So want to stream your timeline for to a remote client for quick feedback and approval? Go ahead.</p>
                <p>Clients can login via desktop or mobile to view the stream, all they need supply is a username, we don't require registration or an email address. If they choose to share their microphone or camera they can talk and communicate with others in the room in real time to give feedback.</p>
                <p>Even without a microphone or camera, clients can annotate directly on the stream and highlighting areas live or drawing boundaries for quick and accurate feedback, shared instantly.</p>
                <p>Nothing to download, nothing to update.</p></p>
                <p>&nbsp;</p>
                <p>&nbsp;</p>
                <p>&nbsp;</p>
                <p>&nbsp;</p>

                <h4>Secure to the core.</h4>
                <p><img src="images/secure.jpg" width="300" height="520" style="border-radius: 10px; overflow: hidden; margin-left:50px; float:right">
                Unlike Zoom or Teams wich require a server, all connections and encoding is handled by you, peer to peer, and are not routed through a central server for distribution. </p>
                <p>Which means we don't see your data, we don't record your data and we don't use your data to train AI.</p>
                <p>WebRTC was designed to be secure from the start and as such all transfers are encrypted using DTLS (Datagram Transport Layer Security) and SRTP (Secure Real-time Transport Protocol). Added to HTTPS encryption this guarantees any communication between you and your clients. STUN (Session Traversal Utilities for NAT) servers help devices behind NAT (Network Address Translation) determine their public IP address and port. This process facilitates peer-to-peer connections, even when devices are located in different network environments.</p>
                <p>All this is handled invisibly and securely behind the scenes, this means your data is encrypted and stays encrypted.</p></p>
                <p>&nbsp;</p>

                </p>
                <h4>So what's the catch?</h4>
                <p>Because all encoding is handled locally, the more clients connect, the greater the load on your machine, typically about a dozen clients should be fine.</p>
                <p>The Streaming part of this app is desktop only, it won't work with mobile devices or tablets. We also strongly recommend using a wired ethernet connection as wifi has some inherit latency issues that can cause the stream to lag or drop out. Streaming and encoding can be offloaded to a separate machine if you want to keep your edit machine free of encoding duties.</p>
                <p>In order to capture your video stream from your edit package you will either need a capture device (a cheap HDMI to USB capture device is fine) Blackmagic and AJA cards are not supported but the Blackmagic Web-presenter will work. An alternative is to use a virtual camera software such as OBS or NDI tools, they're free and they work very well.</p>
                <p>We've had some issues with the colour fidelity with some of the cheaper capture cards, it appears they sometimes double up the LUT on footage, this can cause some pretty big colour disparities so be sure to test first.</p>
                <p>Colour fidelity and audio sync are as good as can be expected within the browser realm, don't expect HDRI or 10 bit colour if you clients are on a cellphone connection, it's good, but it's not perfect. Audio sync can slip if the machine is overloaded or there is some network congestion, but generally it should be within 2 frames.</p>
                <p>We prioritised speed and ease of use over absolute accuracy. This tool is not meant to replace file sharing tools such as frame.io or kollaborate but more to offer a higher quality alternative when presenting to smaller groups.</p>
                <p>If you've read this far and still want to give it a go, use the button bellow to get started.</p>
                <p>&nbsp;</p>

                <p></p>
                <a href="https://alpha.rpxl.app/stream" target="_self" style="text-decoration: none"><button class="botton buttonblue buttonWider">Create a live session</button></a>
                <p>&nbsp;</p>
                <hr>
                <p>&nbsp;</p>
                <h5>
                <sup>*</sup>Okay, you are going need some sort of capture device to get your video into your browser.<br>
                <sup>**</sup>Because we're awesome that way.
                </h5>
                <p>&nbsp;</p>
            </div>
        </div>
        <div class="footer">
            <div class="text">
                <p>&nbsp;</p>
                Links 
                <p></p>
                <a href="https://alpha.rpxl.app/stream/help.html">Creating a stream</a>
                <p></p>
                <a href="https://vdo.ninja">vdo.ninja website</a><br>
                <a href="https://https://docs.vdo.ninja">vdo.ninja documentation</a><br>
                <a href="https://github.com/steveseguin/vdo.ninja">vdo.ninja github</a>
                <p></p>
                <a href="https://discord.com/invite/T4xpQVv">Steve Seguin discord</a>	
                <p></p>
                <a href="https://ndi.video/tools/">ndi tools</a><br>
                <a href="https://obsproject.com">obs studio</a><br>
                <p style="text-align: right;"><a href="#top">back to top</a></p>
                <p>&nbsp;</p>
            </div>
        </div>
    </div>


    <!--iframes for vdo ninja and annotations canvas-->
    <div id="viewerMobile" class="">
        <iframe class="viewersiframe hidden" id="viewersStream" allow="autoplay;camera;microphone;fullscreen;picture-in-picture;display-capture;midi;geolocation;screen-wake-lock;"></iframe>
    </div>

    <div class="mainZoom hidden" id="zoomdiv">
        <iframe class="mainstreamiframe" id="mainStream" allow="autoplay;screen-wake-lock;display-capture;"></iframe>   
        <canvas id="annotationsCanvas" class="annotationsCanvas"></canvas>
    </div>

    <!--Main interface-->
    <div id="mainWindow" class="hidden">
        <!--top menu bar-->
        <div id="topmenu" class="toolbar top">	
            <div style="width:20px"></div>
            <h3 id="sessionTitle">RPXL</h3>&nbsp;<h3 id="sessionID">RPXL</h3>
            <div class="toolspacer"></div>           
            <div class="toolset">
                <a href="https://vdo.ninja" target="_blank" style="text-decoration: none">
                    <button class="botton buttonblue" id="vdoninja">&nbsp;&nbsp;Powered by vdo.ninja&nbsp;&nbsp;</button>
                </a>
            </div>
        </div>
        <!--bottom menu bar-->
        <div id="bottomMenu" class="toolbar bottom">
            <div class="toolset">
                <button class="tool toolmoresettings" id="toolSettings" aria-expanded="false"><span class="material-symbols-outlined">settings</span></button>
            </div>
            <div class="toolset toolspacer">
                <button class="tool toolred disable" aria-expanded="false" id="toolMuteMicrophone"><span class="material-symbols-outlined">mic</span></button>
                <button class="tool disable" aria-expanded="false" id="toolMuteCamera" disabled><span class="material-symbols-outlined">photo_camera</span></button>
            </div>
            <div class="toolset" id="toolAnnotations">
                <button class="tool streamtool disable" aria-expanded="false" id="toolDraw" disabled><span class="material-symbols-outlined">format_ink_highlighter</span></button>
                <button class="tool streamtool toolmoresettings disable" aria-expanded="false" id="toolPalette" disabled><span class="material-symbols-outlined">palette</span></button>
                <button class="tool streamtool disable" aria-expanded="false" id="toolEraser" disabled><span class="material-symbols-outlined">ink_eraser_off</span></button>
            </div>
            <div class="toolspacer"></div>
            <div class="toolset"><button class="tool streamtool disable" aria-expanded="false" id="toolMuteStream" disabled><span class="material-symbols-outlined">volume_up</span></button>   
                <span class="volume streamtool"><input type="range" id="toolStreamVolume" value="80" min="0" max="100" disabled class="streamtool disable"></span>        
            </div>
        </div>
    </div>

    <div class="popupBG hidden" id="popupBG"></div>

    <!--enter username, select camera and microphone dialog-->
    <dialog id="settingsDialog" class="toolpopup top middle hidden">
        <div class="table">
            <div id="camPreview" style="grid-column: 1 / span 2;">
                <video id="camera" class="camera " autoplay playsinline poster=""></video>
                <span id="meterGraph" class="meterGraph"><span id="micmeter" class="meter"></span></span>
            </div>
            <div><span class="material-symbols-outlined" style="justify-content: center; align-items: center;">account_circle</span></div><div><input type="text" maxlength="25" class="textinput" id="name" placeholder="Name (Required)" contenteditable="true" autocomplete="off"></div>
            <div><span class="material-symbols-outlined" style="justify-content: center; align-items: center;">mic</span></div><div class="custom-select"><select id="microphoneSource"><option value="" disabled>None</option></select></div>
            <div><span class="material-symbols-outlined" style="justify-content: center; align-items: center;">photo_camera</span></div><div class="custom-select"><select id="cameraSource"><option value="" disabled>None</option></select></div>
            <div></div><div></div>
            <div style="grid-column: 1 / span 2;"><button id="checkLogin" class="botton buttonblue buttonWider">Join live session</button></div>
        </div>
        <!-- duplicate elements not used (so use same logic in stream and client) -->
        <div class="hidden">Video source</div><div class="custom-select hidden"><select contenteditable="true" id="videoSource"><option value="">None</option></select></div>
        <div class="hidden">Audio source</div><div class="custom-select hidden"><select contenteditable="true" id="audioSource"><option value="">None</option></select> </div>
        <div style="grid-column: 1 / span 2 hidden" id="settingsDialogVideoAudioPreview"><video id="video" class="videosource hidden" autoplay playsinline poster="" muted></video><span id="meterGraph" class="meterGraph hidden"><span id="audiometer" class="meter hiddden"></span></div> 
    </dialog>

    <!----- popup color menu ------>
    <dialog id="paletteDialog" class="toolpopup bottom middle hidden">
            <div>
                <span class="colorpot" value="black" aria-expanded="false" style="background-color: black;"></span>
                <span class="colorpot selectedcolorpot" value="white" aria-expanded="true" style="background-color: white;"></span>
                <span class="colorpot" value="cyan" aria-expanded="false" style="background-color: cyan;"></span>
                <span class="colorpot" value="magenta" aria-expanded="false" style="background-color: magenta;"></span>
                <span class="colorpot" value="yellow" aria-expanded="false" style="background-color: yellow;"></span>
            </div>
    </dialog>

    <!----- Permissions ------>
    <div id="permissionsCheck" class="">
        <dialog id="permissionsDialogClient" class="toolpopup top middle hidden">
            <span class="material-symbols-outlined" style="font-size:125px">error</span><br>
            <h2>Access to your microphone<br>
                or camera is blocked.</h2>
            <p>If you choose to join without a<br>
                microphone or camera other<br>
                guests will not be able to<br>
                hear or see you.</p>
            <p>For help on how to allow<br>
            access, <a href="https://www.google.com/search?q=browser+miicrophone+and+camera+permissions+setup+for+desktop+and+mobile&rlz=1C5CHFA_enCH1148CH1149&oq=browser+miicrophone+and+camera+permissions+setup+for+desktop+and+mobile&gs_lcrp=EgZjaHJvbWUyBggAEEUYOdIBCTIxMDk0ajBqN6gCCLACAfEFhqUbtfZyAjs&sourceid=chrome&ie=UTF-8" target="_new">click here.</a></p>
            <p>If you wish to join anyway</p>
            <button id="permissionIgnore" class="botton buttonblue buttonWider" autofocus> Join anyway </button>
            <!-- <h5>Mic and camera can be muted.</h4> -->
        </dialog>
    </div>

    <!----- popup menu microphone mute ------>
    <dialog id="popupMicMuted" class="toolpopup top middle hidden warning">
        <h2 style="color: var(--color-light-bg)">Warning : Your microphone is muted</h2>
    </dialog>

    <!----- popup menu microphone mute ------>
    <dialog id="popupCamMuted" class="toolpopup top middle  hidden notification">
        <h2>Your camera has been turned off</h2>
    </dialog>

    <!----- popup menu microphone mute ------>
    <dialog id="popupStreamMuted" class="toolpopup top middle  hidden notification">
        <h2>Incoming stream muted (You will still hear participants)</h2>
    </dialog>

    <!----- popup stream zoomed popup------>
    <div id="zoom-popup" class="zoom-popup">Stream zoomed</div>

</body>
</html>

<script src="scripts/deviceselect.js"></script>
<script src="scripts/cookies.js"></script>  <!-- check and store cookies -->
<script src="scripts/initui.js"></script>
<script src="scripts/initvdo.js"></script>
<script src="scripts/interface.js"></script>
<script src="scripts/annotations.js"></script>

<script lang="javascript">
randomBG (); //initui.js

localStorage.clear(); //clear local storage on load to avoid issues with old settings
sessionStorage.clear(); //clear session storage on load to avoid issues with old settings

checkSessionURL ()
//checks if an url parameter supplied, if valid, shows the client login dialog
function checkSessionURL () {
        const queryURL = window.location.search.slice(1);
        let decodeURL;

        try {
            decodeURL = window.atob(queryURL); 
                // Throws DOMException if invalid characters
            } catch (error) {
            if ((error instanceof URIError) || (error instanceof DOMException && error.message.includes("invalid character")) || (error instanceof TypeError)) {
                alert("Invalid Session ID provided in URL.\n\nIf you are seeing this the link supplied has been corrupted or is incomplete.\n\nPlease check with the sender.");
            } else {
                console.error("Unexpected error:", error);
            }
        }

        const params = new URLSearchParams(decodeURL);
        if (params.has('SID')) {
            const SID = params.get('SID');
            const sanitizedSessionID = encodeURIComponent(SID); 
            
            if (!sanitizedSessionID || sanitizedSessionID.length !== 9) {
                console.log('INCORRECTLY FORMATED SESSION ID');
                return;
            } else {
                checkCookie("username", "camera", "mic"); //cookies.js
                sessionStorage.setItem("sessionID", sanitizedSessionID);    //store the sanitized session ID for later

                shmeg.classList.add("hidden");
                settingsDialog.classList.remove("hidden");
                settingsDialog.show();
                document.getElementById("sessionID").innerHTML = "("+sanitizedSessionID+")";

                document.getElementById("name").focus();
                if (params.has('PN')) {
                    const PN = params.get('PN') || "RPXl";
                    const decodePN = decodeURI(PN);
                    //console.log('Name parameter exists',decodePN);
                    document.getElementById("sessionTitle").innerHTML = decodePN;
                }                
            }
        }      
}

//User, camera and microphone dialogue window submit button and enter actions (run setupSession())
document.getElementById("checkLogin").addEventListener("click", setupSession);
document.getElementById("name").addEventListener("keypress", function(event) {
	if (event.key === "Enter") {
		event.preventDefault();        //stop form submitting before we check values
		document.getElementById("checkLogin").click();
		}
	});

//check that the user has entered a name
function setupSession() {
    const nameInput = document.getElementById("name");

    let username = nameInput.value.trim();
    sanitizedUserName = encodeURIComponent(username); 

    if (!sanitizedUserName) {           //if no username flash and select;
        nameInput.style.animation = "pulse 500ms";
        setTimeout(() => { nameInput.style.animation = "none"; }, 500);
        nameInput.focus();
        return;
    } else {
        //hide the user, camera and microphone dialog
        settingsDialog.close();     
        document.getElementById("settingsDialog").classList.add("hidden");  
        document.getElementById("popupBG").classList.add("hidden");
        document.getElementById("shmeg").classList.add("hidden");
        document.getElementById("mainWindow").classList.remove("hidden");      
        document.body.style.backgroundImage = "none";

        //change login dialog layout (remove camera preview)
        document.getElementById("settingsDialog").classList.remove("top", "middle");        
        document.getElementById("settingsDialog").classList.add("toolpopup", "bottom", "left");
        document.getElementById("camPreview").style.display = "none";
        document.getElementById("checkLogin").innerHTML = "Change settings";
        checkLogin.removeEventListener("click", setupSession);    // Remove start session listener and add settings change listener
        // Events to allow zooming in of stream
        window.addEventListener("wheel", onWheel, { passive: false });
        window.addEventListener("mousedown", onMouseDown);
        window.addEventListener("mousemove", onMouseMove);
        window.addEventListener("mouseup", onMouseUp);

        checkLogin.addEventListener("click",() => {
            viewerStream() ; //from initvdo.js
        });

        viewerStream(); //from initvdo.js
        setTimeout(function(){   
            viewMainStream();//from initvdo.js
        },250);
    }
}
</script>
